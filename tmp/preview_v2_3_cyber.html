<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tex-Machina | Cyber-Grid</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0a0a;
            --fg: #00ff41;
            --panel: #111;
            --border: #333;
            --accent: #00ff41;
            --font-mono: 'JetBrains Mono', monospace;
        }

        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: var(--bg); color: var(--fg);
            font-family: var(--font-mono);
            overflow: hidden;
            background-image: linear-gradient(var(--border) 1px, transparent 1px), linear-gradient(90deg, var(--border) 1px, transparent 1px);
            background-size: 50px 50px;
        }

        #header {
            height: 50px; display: flex; align-items: center; padding: 0 20px;
            background: rgba(0,0,0,0.9); border-bottom: 2px solid var(--fg); z-index: 100;
        }

        .btn {
            background: transparent; border: 1px solid var(--fg); color: var(--fg);
            padding: 5px 15px; cursor: pointer; font-family: var(--font-mono); font-size: 12px;
            margin-left: 10px; text-transform: uppercase;
        }
        .btn:hover { background: var(--fg); color: black; }

        #inspector {
            position: absolute; bottom: 20px; left: 20px; right: 20px; height: 200px;
            background: rgba(0,0,0,0.9); border: 1px solid var(--fg);
            display: none; padding: 20px; z-index: 200; overflow: auto;
        }

        .math-preview {
            border: 1px dashed var(--fg); padding: 10px; margin: 10px 0;
            filter: drop-shadow(0 0 5px var(--fg));
        }

        #legend {
            position: absolute; top: 70px; right: 20px;
            border: 1px solid var(--border); padding: 15px; background: rgba(0,0,0,0.8);
            font-size: 10px;
        }
    </style>
</head>
<body>
    <div id="header">
        <div>[ TEX_MACHINA_SYSTEM_v1.0 ]</div>
        <div style="flex-grow: 1"></div>
        <button class="btn" onclick="network.fit()">RE-SCAN</button>
    </div>
    
    <div id="viz" style="width: 100%; height: calc(100vh - 50px);"></div>

    <div id="legend">
        <div>> NODE_TYPES</div>
        <div style="color:#ff003c">> SECTION</div>
        <div style="color:#00ff41">> EQUATION</div>
        <div style="color:#00ccff">> FIGURE</div>
    </div>

    <div id="inspector">
        <div style="display:flex; justify-content:space-between">
            <div id="ins-label" style="font-weight:bold; font-size:18px;">ID: UNKNOWN</div>
            <button class="btn" onclick="document.getElementById('inspector').style.display='none'">[X]</button>
        </div>
        <div id="ins-meta">LOCATING_DATA...</div>
        <div class="math-preview" id="math-target"></div>
    </div>

    <script>
        let nodes, edges, network;
        const initialNodes = [
            { id: 's1', label: 'SEC_INTRO', type: 'section', line: 1, refs: 2, content: '	ext{Introduction}' },
            { id: 'e1', label: 'EQ_EINSTEIN', type: 'equation', line: 10, refs: 15, content: 'E = mc^2' },
            { id: 's2', label: 'SEC_THEORY', type: 'section', line: 5, refs: 8, content: '	ext{Theoretical Basis}' }
        ];
        const initialEdges = [{ from: 'e1', to: 's2' }];

        function formatNode(n) {
            const colors = { section: '#ff003c', equation: '#00ff41', figure: '#00ccff' };
            return {
                id: n.id, label: n.label, shape: 'square', size: 10,
                color: { background: '#000', border: colors[n.type]||'#00ff41' },
                font: { color: colors[n.type]||'#00ff41', face: 'JetBrains Mono', size: 12 },
                borderWidth: 2, metadata: n
            };
        }

        function init() {
            nodes = new vis.DataSet(initialNodes.map(formatNode));
            edges = new vis.DataSet(initialEdges.map(e => ({
                ...e, color: '#333', arrows: 'to', width: 2, smooth: {type: 'discrete'}
            })));
            network = new vis.Network(document.getElementById('viz'), { nodes, edges }, {
                physics: { enabled: true, solver: 'repulsion' }
            });
            network.on("click", (p) => {
                if (p.nodes.length > 0) {
                    const node = nodes.get(p.nodes[0]).metadata;
                    document.getElementById('ins-label').innerText = `ID: ${node.label}`;
                    document.getElementById('ins-meta').innerText = `LINE: ${node.line} | REF_COUNT: ${node.refs}`;
                    document.getElementById('math-target').innerHTML = `\[ ${node.content} \]`;
                    document.getElementById('inspector').style.display = 'block';
                    if (window.MathJax) MathJax.typesetPromise();
                }
            });
        }
        window.onload = init;
    </script>
</body>
</html>
